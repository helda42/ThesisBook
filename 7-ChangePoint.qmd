---
title: "Relationship between NTS immunity and age in Children aged 0-60 months across four sub-Saharan African sites: Principled Change Point Analysis"
format:    
  pdf:
    mainfont: Didot
    geometry:
      - top=20mm
      - bottom=20mm
      - left=20mm
      - right=20mm
    toc: true
    number-sections: true
    colorlinks: true
    include-in-header:
      text: |
        \usepackage{typearea}
    cite-method: citeproc
    bibliography: references.bib
    csl: diabetologia.csl
editor: visual
---

## Introduction

Understanding the age-distribution of natural immunity to non-typhoidal salmonella (NTS) in children living in areas endemic to invasive NTS is key to understanding potential windows of immune-susceptibility to disease. This knowledge is key to informing vaccine development, including identifying the ages at which children have a nadir of antibody that could be boosted by vaccine-derived immunity, and to explore the potential role for maternal vaccines. As described in the previous chapter, the key components are the role of maternally acquired immunity in the first 6 months of life, followed by acquisition of naturally acquired immunity after 6 months of life, which increases rapidly after exposure to enteric NTS. Understanding the role of maternally acquired immunity in protection against invasive disease is vital in understanding natural protection against invasive disease and guiding vaccine strategies, including considerations for the potential role for maternal vaccines. Data on the age of nadir and antibody concentration at this nadir across a range of epidemiological settings is essential to guide vaccine strategies across different countries and geographic settings with different patterns of host risk factors.

Malaria has been associated with increased risk of developing invasive NTS disease in children (3,4), which has been proposed to impair the innate, humoral and cell-mediated immune responses against NTS (5,6). Immunoglobulin-gamma (IgG) antibodies against NTS lipopolysaccharide (LPS) have been associated with protection against iNTS (7), and are being currently investigated as a potential correlate of protection for clinical vaccine trials. However, little attention has been paid to the role malaria may have on maternally acquired immunity. Placental malaria has been associated with impaired transplacental transfer of antibodies to a range of vaccine preventable infections (8‚Äì13), although the association has been inconsistent across studies.

## Methods

### Study Design

The relationship between age and antibody concentrations for IgG to S. Typhimurium and S.Enteritidis O-Ag were examined from the cross-sectional serosurveys for each VacciNTS site; Malawi, Kenya, Burkina Faso as described in chapter 2. In Malawi, the relationship between age and antibody concentration was stratified by malaria transmission intensity. Site-specific malaria transmission data was not available for Burkina Faso or Kenya.

### Definitions

-   Low Malaria Transmission \<5% MRDT positivity

-   High Malaria Transmission \>=5% positivity

### Statistical Methods

A flexible modelling framework using linear splines for censored regression models to estimate serological profiles, as developed by Henrion *et a*l [@swarthout_waning_2022].\], was used to identify the peaks and troughs of IgG antibodies to a range of pneumococcal serotypes, by age at a population level.

Before model fitting, the IgG data are log-transformed, so that the fitted arithmetic mean corresponds to the log of the geometric mean on the original data scale. The ELISA assays for anti-Salmonella O-Antigen antibodies had a lower limit of detection (LLD, 3 ELISA Units/mL); as a result any observations below the detection limit (DL) are left-censored. To account for this, censored regression was used. A Gaussian linear model for ùë¶, the natural logarithm of the measured IgG concentration, was selected, with a single explanatory variable, ùë•,

$$
age: y = \beta0 + \beta1x + \epsilon = f(x, \beta) + \epsilon (1)
$$ where: $\epsilon \sim N(0, \sigma^2)$

As we cannot not directly observe ùë¶, we can use ùë¶ùëÄ, where values below the detection limit are censored:

$$
ùë¶ùëÄ = {ùë¶, ùë¶ > \tau, ùë¶ ‚â§ \tau} 
$$ where $\tau$ is the lower limit of detection ($\tau$ = 3EU/mL in our data).

Assuming a Gaussian model, we can write, for an observed data set:

$$ {ùë•_ùëñ , ùë¶ùëÄ,ùëñ }$$ $$ ùëñ=1 ùëõ  $$

the loglikelihood below, utilising the maximum likelihood inference theory:

$$ùëô(\beta, \sigma^2 ) = \sum ùë¶ùëÄ,ùëñ>\tau log (\phi ((ùë¶ùëÄ,ùëñ ‚àí ùëì(ùë•,\beta)) /\sigma))+ \sum ùë¶ log ùëÄ,ùëñ‚â§\tau (\phi(ùëì(ùë•, \beta) ‚àí \tau)) (2)$$

To identify and estimate change points I used linear regression splines to fit a model that allows the linear relationship between age and IgG to change over time. Fitting a piece-wise linear regression model, allows the slope to change at specific values of the predictor variable. These change points, or knots, split the model into intervals; within each interval the relationship between predictor and response is linear.

For a response ùë¶ and a predictor ùë•, a linear spline with 3 knots at locations $ùë• = ùëò_1 , ùëò_2 , ùëò_3$

$$ ùë¶ = \beta_0 + \beta_1 ‚ãÖ ùë• + \beta_2 ‚ãÖ (ùë• ‚àí ùëò_1 ) + \beta_3 ‚ãÖ (ùë• ‚àíùëò_2 )+ +\beta_4 ‚ãÖ (ùë• ‚àí ùëò_3 ) + \epsilon (3) $$

where (ùë•)+ = ùë• if ùë• ‚â• 0 and 0 otherwise. This means that the fitted curve has different slopes in different intervals of values of ùë•:

$$interval Slope (-Inf, k_1) \beta_1 [k_1,k_2) \beta_1 + \beta_2 [k_2,k_3) \beta_1 + \beta_2 + \beta_3 [k_3,Inf) \beta_1 + \beta_2 + \beta_3 + \beta_44$$

Usually splines are used to produce smooth fits using cubic rather than linear functions, and knot locations are either user-provided or set to regular intervals in the predictor variable. For the purpose of this analysis however, the number and the locations of the knots, i.e., the change points, are of interest themselves and making statistical inference on the knot locations is a key research question. Therefore the knot locations $ùëò_1 , ùëò_2 , ùëò_3...$ are added as model parameters and estimated using numerical optimisation; minimisation of a least squares function. Confidence intervals for the locations of the knots and the slopes were derived using bootstrapping (bootstrap percentile method), as maximum likelihood can not be used after making the knots parameters in the model.

Models were fit with a number of knots ranging from zero to three, and the best fitting model was selected by Akaike Information Criterion (AIC).

Implementation was done in the R environment for statistical programming, using packages rms (for linear spline terms), censReg (for the censored regression likelihood), boot (for the bootstrapped CIs) and custom code to estimate model parameters and selecting the number of knots / changepoints.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(censReg) # for Tobin / censored regression models
library(rms) # for spline terms
library(boot) # to compute adjusted percentile method bootstrap CIs
library(tidyverse)
library(grid)
library(gridExtra)
library(here)
library(rio)
library(rlist)
library(cowplot)
library(flextable)
library(scrutiny)

## Plot function
ggPlotFun<-function(fit,fit2,strain,varNameOrigNum,DL=3.5,colModel="red",colModelCI="red",colData="grey50",colGeoM="black",colChangepoints="grey70",alphaModelCI=70,alphaChangepoints=150,alphaData=50,cexData=0.2,cexGeoM=1,doLegend=TRUE,xLegPoints=38,xLegRibbons=c(48,51),yLegMin=4,plotModel=TRUE,colAnnot="black",xAnnot=60,cexAnnot=2.5,cexText=7,doGeoMConfInt=FALSE,axisLabels=TRUE,s,c){
  yMin<-min(c(DL,fit$datGeoM$geoM_better))
  yMax<-max(fit2$dat[,varNameOrigNum],na.rm=TRUE)
  
  if(plotModel){
    dfCI<-data.frame(x=fit$xxCI,ymin=fit$yyLow,ymax=fit$yyHigh)
    dfFit<-data.frame(x=fit$xx,y=fit$yy)
    dfKnots<-NULL
    dfKnotsCI<-NULL
    if(fit$k>0){
      dfKnots<-data.frame(x=fit$coefs[2+fit$k+1+1:fit$k])
      dfKnotsCI<-data.frame(x=numeric(),y=numeric(),k=integer())
      for(i in 1:fit$k){
        dfKnotsCI<-rbind(dfKnotsCI,data.frame(x=fit$knotCIs[[i]]$perc[4:5],ymin=rep(10^(log10((1+(i-1)*0.11)*0.75*yMax)),2),ymax=rep(10^(log10((1.1+(i-1)*0.11)*0.75*yMax)),2),k=i))
      }
    }
  }
  
  
  if(doGeoMConfInt){
    varNameOrig<-gsub(varNameOrigNum,pattern="_[a-zA-Z0-9]*",replacement="")
    varNameOrigNum<-paste(sep="_",varNameOrig,"num")
    
    fit$dat<-fit$dat %>% mutate(
      geoMLow=NA,
      geoMUpp=NA,
      age_cat_gmc = fct_relevel(age_cat_gmc, c("[0,3]", "(3,6]","(6,9]","(9,12]","(12,15]", "(15,18]", "(18,21]","(21,24]","(24,27]", "(27,30]","(30,33]","(33,36]","(36,39]", "(39,42]", "(42,45]","(45,48]","(48,51]", "(51,54]","(54,57]","(57,60]"))
    )
    
    for(i in 1:nrow(fit$datGeoM)){
      if(sum(fit$dat[fit$dat$age_cat_gmc==fit$datGeoM$ageCat[i],varNameOrigNum]<3.5)>0){
        if(sum(fit$dat[fit$dat$age_cat_gmc==fit$datGeoM$ageCat[i],varNameOrigNum]<3.5)==sum(fit$dat$age_cat_gmc==fit$datGeoM$ageCat[i])){
          tmp<-rep(DL,2)
        }else{
          tmp<-exp(confint(censReg(as.formula(paste(sep="","log(",varNameOrigNum,")~1")),data=fit$dat[fit$dat$age_cat_gmc==fit$datGeoM$ageCat[i],],left=log(DL)))["(Intercept)",])
        }
      }else{
        tmp<-exp(confint(lm(as.formula(paste(sep="","log(",varNameOrigNum,")~1")),data=fit$dat[fit$dat$age_cat_gmc==fit$datGeoM$ageCat[i],]))["(Intercept)",])
      }
      fit$datGeoM$geoMLow[i]<-tmp[1]
      fit$datGeoM$geoMUpp[i]<-tmp[2]
    }
    geoM<-data.frame(age=fit$datGeoM$ageCat,geoM=paste(sep="",format(nsmall=2,round(digits=2,fit$datGeoM$geoM_better))," (",format(nsmall=2,round(digits=2,fit$datGeoM$geoMLow)),",",format(nsmall=2,round(digits=2,fit$datGeoM$geoMUpp)),")"))
  }else{
    geoM<-NULL
  }
  
  dfText<-data.frame(
    x=c(rep(xLegPoints+2,2),rep(xLegRibbons[2]+2,3)),
    y=c(yLegMin*1.5*1.5,yLegMin*1.5,yLegMin*1.5*1.5,yLegMin*1.5,yLegMin),
    lab=c("data","GMC","model fit","95% CI (model fit)","95% CI (change points)")
  )
  if(!plotModel){dfText<-dfText[1:2,]}
  
  if(doLegend){
    mar<-c(5,0.5,0.5,0.5)
    clipOnOff<-"off"
  }else{
    mar<-rep(0.5,4)
    clipOnOff<-"on"
  }
  
  rgbTmp<-col2rgb(colData)
  rgbData<-rgb(red=rgbTmp[1],green=rgbTmp[2],blue=rgbTmp[3],alpha=alphaData,maxColorValue=255)
  rgbTmp<-col2rgb(colGeoM)
  rgbGeoM<-rgb(red=rgbTmp[1],green=rgbTmp[2],blue=rgbTmp[3],alpha=255,maxColorValue=255)
  rgbTmp<-col2rgb(colModel)
  rgbModel<-rgb(red=rgbTmp[1],green=rgbTmp[2],blue=rgbTmp[3],alpha=255,maxColorValue=255)
  rgbTmp<-col2rgb(colModelCI)
  rgbModelCI<-rgb(red=rgbTmp[1],green=rgbTmp[2],blue=rgbTmp[3],alpha=alphaModelCI,maxColorValue=255)
  rgbTmp<-col2rgb(colChangepoints)
  rgbChangepoints<-rgb(red=rgbTmp[1],green=rgbTmp[2],blue=rgbTmp[3],alpha=alphaChangepoints,maxColorValue=255)
  
  g<-ggplot() +
    geom_point(data=fit$dat,mapping=aes(x=ageMonths,y=get(varNameOrigNum)),col=rgbData,pch=1,size=cexData) +
    {if(plotModel) geom_line(data=dfFit,mapping=aes(x=x,y=y),col=rgbModel,lwd=0.5)} +
    geom_point(data=fit$datGeoM,mapping=aes(x=ageCatNum,y=geoM_better),pch=20,size=cexGeoM,col=rgbGeoM) +
    {if(plotModel) geom_ribbon(data=dfCI,mapping=aes(x=x,ymin=ymin,ymax=ymax),fill=rgbModelCI)} +
    {if(plotModel) geom_vline(data=dfKnots,mapping=aes(xintercept=x),lty=2,lwd=0.5,col=rgbChangepoints)} +
    {if(plotModel) geom_ribbon(data=dfKnotsCI,mapping=aes(x=x,ymin=ymin,ymax=ymax,group=k),fill=rgbChangepoints)} +
    theme_light() +
    theme(plot.margin = unit(mar, "lines"),text=element_text(size=cexText)) +
    scale_x_continuous(breaks = seq(0, 60, by = 3)) +
    scale_y_log10() +
    coord_cartesian(xlim = c(0,60), ylim = c(yMin,yMax),clip=clipOnOff) +  # ylim = c(0,10000)
    # coord_cartesian(xlim = c(0,60), ylim = c(min(fitListIgG[[s]]$Malawi$dat$, na.rm=T), max(fit3$dfCI$yyHigh, na.rm=T))) +
    {if(axisLabels) labs(y=paste(sep="",strain," IgG concentration (EU/ml)"),x="Age (months)")} +
    {if(!axisLabels) labs(y=NULL,x=NULL)} +
    {if(doLegend) geom_point(data=data.frame(x=xLegPoints,y=6),mapping=aes(x=x,y=y),pch=20,size=cexGeoM,col=rgbGeoM)} +
    {if(doLegend) geom_point(data=data.frame(x=xLegPoints,y=8),mapping=aes(x=x,y=y),pch=1,size=cexData,col=rgbData)} +
    {if(doLegend & plotModel) geom_ribbon(data=data.frame(x=xLegRibbons,ymin=rep(yLegMin*1.5*1.5,2),ymax=rep(yLegMin*1.5*1.5*1.1,2)),mapping=aes(x=x,ymin=ymin,ymax=ymax),fill=rgbModel)} +
    {if(doLegend & plotModel) geom_ribbon(data=data.frame(x=xLegRibbons,ymin=rep(yLegMin*1.5,2),ymax=rep(yLegMin*1.5*1.1,2)),mapping=aes(x=x,ymin=ymin,ymax=ymax),fill=rgbModelCI)} +
    {if(doLegend & plotModel) geom_ribbon(data=data.frame(x=xLegRibbons,ymin=rep(yLegMin,2),ymax=rep(yLegMin*1.1,2)),mapping=aes(x=x,ymin=ymin,ymax=ymax),fill=rgbChangepoints)} +
    {if(doLegend) geom_text(dat=dfText,mapping=aes(x=x,y=y,label=lab),hjust=0,vjust=0.25,size=1.5)} +
    {if(doGeoMConfInt) geom_errorbar(data=fit$datGeoM,mapping=aes(x=ageCatNum,ymin=geoMLow,ymax=geoMUpp),col=colGeoM,lwd=0.15,width=0.3)} +
   # geom_text(data=data.frame(x=xAnnot,y=0.8*yMax,label=paste0(sep=" ",strain," IgG, ",c)),mapping=aes(x=x,y=y,label=label),col=colAnnot,size=cexAnnot,hjust=1,vjust=1,fontface="bold") +
    geom_text(data=data.frame(x=xAnnot,y=0.8*yMax,label=strain),mapping=aes(x=x,y=y,label=label),col=colAnnot,size=cexAnnot,hjust=1,vjust=1,fontface="bold") +
    geom_hline(yintercept=3.5, linetype="dashed", color = "red", size=0.3) +
    geom_text(aes(x=0,y=150,label=round(CpIgG[[s]][[c]]$IgG_age0,digits=1)),size=cexAnnot, fontface="bold",col=colModel)+
    geom_text(aes(x=5.5,y=20,label=round(CpIgG[[s]][[c]]$low,digits=1)),size=cexAnnot,fontface="bold",col=colModel)+
    geom_text(aes(x=27,y=100,label=round(CpIgG[[s]][[c]]$peak,digits=1)),size=cexAnnot,fontface="bold",col=colModel)+
    geom_text(aes(x=60,y=150,label=round(CpIgG[[s]][[c]]$IgG_age60,digits=1)),size=cexAnnot,fontface="bold",col=colModel)
    #geom_line(data=risk_per_3mth_logscale,aes(y=risk_pred, x=midage)) +
    #geom_ribbon(data=risk_per_3mth_logscale,aes(ymax=risk_high, ymin=risk_low, x=midage), fill="red", alpha=0.3 )
  
  return(list(g=g,fit=fit,geoM=geoM))
}

```

```{r echo=FALSE, warning=FALSE, message=FALSE}

st <- c("STm", "SEn")
co <- c("Malawi", "Kenya", "BF")
fitListIgG <- list()
CpIgG <- list()
parsMat <- list()
plotls <- list()
CpIgG_ls <- list()
parsMat_ls <- list()
raw <- list()
raw_ls <- list()

# raw$Malawi <- import(here("data", "VacciNTS_sites", "Malawi_STmIgG_master.csv"))
# raw$BF <- import(here("data", "VacciNTS_sites", "BF_STmIgG_master.csv"))
# raw$Kenya <- import(here("data", "VacciNTS_sites", "Kenya_STmIgG_master.csv"))

for(s in st){
  for(c in co){
    fitListIgG[[s]][[c]] <- import_list(here("data", "7_data", "VacciNTS_sites", paste(sep="","fit",s,c,".RData")))#
    CpIgG[[s]][[c]] <- import(here("data", "7_data", "VacciNTS_sites", paste(sep="","peaksLowsTroughsMat",s,c,"_IgG.csv"))) %>% mutate(country = c, strain = s)
    # CpIgG[[s]][[c]]$country <- mutate(country = c, strain = s)
    parsMat[[s]][[c]] <- import(here("data", "7_data", "VacciNTS_sites", paste(sep="","parsMat",s,c,"_IgG.csv"))) %>% mutate(country = c, strain = s)
    # parsMat[[s]][[c]] <- mutate(country = c, strain = s)
    CpIgG[[s]][[c]]$low_age <- round(CpIgG[[s]][[c]]$low_age,digits=1)
    CpIgG[[s]][[c]]$peak_age <- round(CpIgG[[s]][[c]]$peak_age, digits = 1)
    # IgGT0_[[s]][[c]] <- parsMat[[s]][[c]]$IgGTime0
    # IgGNadir_[[s]][[c]] <- parsMat[[s]][[c]]$IgGNadir
    # IgGPeak_[[s]][[c]] <- parsMatT[[s]][[c]]$IgGPeak
    # IgGT60_[[s]][[c]] <- parsMatTmp[[s]][[c]]$IgGTime60
    raw[[s]][[c]] <- import(here("data", "7_data", "VacciNTS_sites", paste(sep="",c,"_",s,"IgG_master.csv"))) %>% select(EU_all.sero) %>% mutate(country = c, strain = s)
    raw[[s]][[c]]$median <- round(median(raw[[s]][[c]]$EU_all.sero, na.rm=TRUE), digits = 1)
    raw[[s]][[c]]$q25 <- round(quantile(raw[[s]][[c]]$EU_all.sero, 0.25, na.rm=TRUE), digits=1)
    raw[[s]][[c]]$q75 <- round(quantile(raw[[s]][[c]]$EU_all.sero, 0.75, na.rm=TRUE), digits = 1)

    plotls[[s]][[c]] <- ggPlotFun(fit=fitListIgG[[s]][[c]], fit2=fitListIgG[[s]]$Malawi, strain=c,varNameOrigNum=paste(sep="",s,"_num"),colModel=ifelse(s=="STm","steelblue","orchid"),colModelCI=ifelse(s=="STm","steelblue","orchid"),colChangepoints="orange",s=s,c=c)$g
   }
  #   panel1 <- do.call("plot_grid", c(plotls[[s]], ncol=2, labels="AUTO"))
  #   print(panel1)
  CpIgG_ls[[s]] <- do.call("rbind", CpIgG[[s]]) #%>% relocate(c("strain", "country"), .before = IgG_age0)
  parsMat_ls[[s]] <- do.call("rbind", parsMat[[s]]) 
  raw_ls[[s]] <- do.call("rbind", raw[[s]]) 
} 

raw_df <- do.call("rbind", raw_ls) %>% 
  mutate(median_comb = paste0(sep=" ", median, " (", q25,"-", q75, ")")) %>% 
  select(c(country, strain, median_comb)) %>% 
  group_by(country, strain) %>% 
  mutate(N = n()) %>% 
  slice_head(n=1) %>% 
  ungroup() %>% 
  relocate(N, .before = median_comb) %>% 
  arrange(desc(strain), desc(country))

medMalSTm <- raw_df %>% 
  subset(country=="Malawi" & strain=="STm", median_comb)
medKenSTm <- raw_df %>% 
  subset(country=="Kenya"& strain=="STm", median_comb)
medBFSTm <- raw_df %>% 
  subset(country=="BF"& strain=="STm", median_comb)
medMalSEn <- raw_df %>% 
  subset(country=="Malawi" & strain=="SEn", median_comb)
medKenSEn <- raw_df %>% 
  subset(country=="Kenya" & strain=="SEn", median_comb)
medBFSEn <- raw_df %>% 
  subset(country=="BF"& strain=="SEn", median_comb)
NMalSTm <- raw_df %>% 
  subset(country=="Malawi" & strain=="STm", N)
NKenSTm <- raw_df %>% 
  subset(country=="Kenya"& strain=="STm", N)
NBFSTm <- raw_df %>% 
  subset(country=="BF"& strain=="STm", N)
NMalSEn <- raw_df %>% 
  subset(country=="Malawi" & strain=="SEn", N)
NKenSEn <- raw_df %>% 
  subset(country=="Kenya"& strain=="SEn", N)
NBFSEn <- raw_df %>% 
  subset(country=="BF"& strain=="SEn", N)
```

## Results

### VacciNTS Sites

#### Descriptive Analysis

The number of samples included in the analysis were `{r} NMalSTm` from Malawi, `{r} NBFSTm` from Burkina Faso and `{r} NKenSTm` from Kenya for *S*. Typhimurium; `{r} NMalSEn` from Malawi, `{r} NBFSEn` from Burkina Faso and `{r} NKenSEn` from Kenya for *S*. Enteriditis. Overall across all ages O-Ag IgG antibody levels for *S*. Typhimurium ranged from in Malawi a median and interquartile range (IRQ) of `{r} medMalSTm`, Burkina Faso `{r} medBFSTm`, and Kenya `{r} medKenSTm` (@tbl-desc). For *S.* Enteritidis values were for Malawi `{r} medMalSEn`, Burkina Faso `{r} medBFSEn`, and Kenya `{r} medKenSEn`.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
#| label: tbl-desc
#| tbl-cap: "Summary of number of samples included in analysis and median and interquartile ranges (IQR)"
#| 
raw_ft <- flextable(raw_df)
raw_ft %>% 
      fontsize(size=8, part = "body") %>% 
      fontsize(size=8, part = "header") %>% 
      bold(i = 1, bold = TRUE, part = "header") %>%           
      set_header_labels(
        strain = "Strain",
        country = "Country", 
        N = "Number of samples", 
        median_comb = "Median (IQR)"
      ) %>% 
      # set_caption( 
      #   caption = "Population Nadirs and Peaks of IgG to Salmonella Typhimurium and Enteriditis in children 0-60 months across three sub-Saharan African sites; Change point model estimates", 
      #   style = "Table Caption") %>% 
      autofit()
```

#### Anti-LPS O-Ag IgG: Relationship with age

Change point analysis (piecewise linear regression) was carried out to identify peaks and nadirs in immunity associated with age, for the data from Malawi, Burkina Faso and Kenyan sites. Change point analysis shows all three sites had a peak geometric mean concentration (GMC) at birth, falling to a nadir at 4.1-6.0 months, the increasing to a plateau (18-40 months), for both OAg IgG to *S*. Typhimurium and *S*. Enteritidis (@fig-STm, @fig-SEn, @tbl-sites). All results are presented with GMC and 95% confidence intervals in brackets.

#### OAg IgG to S. Typhimurium

Anti-LPS OAg IgG to *S.* Typhimurium GMC in Kenyan children was higher at birth `{r} parsMat$STm$Kenya$IgGTime0` EU (ELISA units)/mL, compared to Burkina Faso `{r} parsMat$STm$BF$IgGTime0` EU/ml and Malawi `{r} parsMat$STm$Malawi$IgGTime0` EU/mL ( @fig-combined A). The nadir was `{r} parsMat$STm$Malawi$IgGNadir` EU/ml in Malawi at `{r} CpIgG$STm$Malawi$low_age` months compared to Burkina Faso `{r} parsMat$STm$BF$IgGNadir`, and Kenya `{r} parsMat$STm$Kenya$IgGNadir` at `{r} CpIgG$STm$Kenya$low_age` and `{r} CpIgG$STm$BF$low_age` months respectively. Kenyan children reached a relative plateau at `{r} CpIgG$STm$Kenya$peak_age` months (`{r} parsMat$STm$Kenya$IgGPeak` EU/ml), later reaching a maximum at 60 months (`{r} parsMat$STm$Kenya$IgGTime60` EU/ml). In contrast Malawian children plateaued at `{r} CpIgG$STm$Malawi$peak_age` months, `{r} parsMat$STm$Malawi$IgGPeak` EU/ml, and Burkina Faso at `{r} CpIgG$STm$BF$peak_age` months, `{r} parsMat$STm$BF$IgGPeak` EU/ml.

#### OAg IgG to S. Enteritidis

Anti-LPS OAg IgG to *S.* Enteritidis; Kenyan children GMC was higher at birth `{r} parsMat$SEn$Kenya$IgGTime0` EU/mL, compared to Burkina Faso `{r} parsMat$SEn$BF$IgGTime0` and Malawi `{r} parsMat$SEn$Malawi$IgGTime0` ( @fig-combined B) The nadir was lowest and earliest in Malawi `{r} parsMat$SEn$Malawi$IgGNadir` EU/ml at `{r} CpIgG$SEn$Malawi$peak_age` months, compared to Burkina Faso `{r} parsMat$SEn$BF$IgGNadir` and Kenya `{r} parsMat$SEn$Kenya$IgGNadir` EU/ml at `{r} CpIgG$STm$BF$low_age` months. Burkina Faso children rapidly reached a plateau at `{r} CpIgG$SEn$BF$peak_age` months, with Kenyan and Malawian children reaching a plateau slightly later at `{r} round(CpIgG$SEn$Kenya$peak_age,digits=1)` and `{r} CpIgG$SEn$Malawi$peak_age` months respectively. After this initial plateau, Malawian children had relatively stable GMCs of `{r} parsMat$SEn$Malawi$IgGPeak` EU/ml at `{r} CpIgG$SEn$Malawi$peak_age` months, with a slight decline after 58 months. In contrast, Kenyan children continued to have a rise in GMC, peaking at `{r} parsMat$SEn$Kenya$IgGPeak` EU/ml at `{r} CpIgG$SEn$Kenya$peak_age` months.

\newpage

<!-- changing the orientation to landscape --------------------------------- -->

```{=tex}
\KOMAoptions{usegeometry, paper=landscape,pagesize}
\recalctypearea
```
```{r echo=FALSE, warning=FALSE, fig.align = "centre", fig.width = 9, fig.height=8, out.width = "9.5in"}
#| label: fig-STm
#| fig-cap: "Change Point Analysis for Salmonella Typhimurium (STm) IgG antibodies to O-Ag by age at three sites; A. Malawi, B. Kenya, C. Burkina Faso"
#| 
    panel1 <- do.call("plot_grid", c(plotls$STm, ncol=2, labels="AUTO", label_size=8))
    print(panel1)

```

```{r echo=FALSE, warning=FALSE, fig.align = "centre", fig.width = 9, fig.height=8, out.width = "9.5in"}
#| label: fig-SEn
#| fig-cap: "Change Point Analysis for Salmonella Enteritidis (SEn) IgG antibodies to O-Ag by age at three sites; A. Malawi, B. Kenya, C. Burkina Faso"
#| 
    panel2 <- do.call("plot_grid", c(plotls$SEn, ncol=2, labels="AUTO", label_size=8))
    print(panel2)
```

```{r echo=FALSE, warning=FALSE, fig.align = "centre", fig.width = 8, fig.height=8, out.width = "8.5in"}
#| tbl-cap: "Population Nadirs and Peaks of IgG to Salmonella Typhimurium and Enteriditis in children 0-60 months across three sub-Saharan African sites; Change point model estimates"
#| label: tbl-sites

## Results preparation
CpIgG_df <- do.call("rbind", CpIgG_ls)
parsMat_df <- do.call("rbind", parsMat_ls)
Cptbl <- left_join(CpIgG_df, parsMat_df, by=c("strain", "country")) %>% 
  select(c(strain, country, IgGTime0, low_age, IgGNadir, peak_age, IgGPeak, IgGTime60))
Cptblft <- flextable(Cptbl)
Cptblft %>% 
      fontsize(size=8, part = "body") %>% 
      fontsize(size=8, part = "header") %>% 
      bold(i = 1, bold = TRUE, part = "header") %>%           
      set_header_labels(
        strain = "Strain",
        country = "Country", 
        IgGTime0 = "IgG age 0", 
        low_age = "Nadir age", 
        IgGNadir = "IgG nadir",
        peak_age = "Peak age", 
        IgGPeak = "IgG peak",
        IgTime60 = "IgG age 60m"
      ) %>% 
      set_caption( 
        # caption = "Population Nadirs and Peaks of IgG to Salmonella Typhimurium and Enteriditis in children 0-60 months across three sub-Saharan African sites; Change point model estimates", 
        style = "Table Caption") %>% 
      autofit()
```

```{r echo=FALSE, warning=FALSE, fig.align = "centre", fig.width = 9.5, fig.height=3.5, out.width = "10in"}
#| fig-cap: "Change Point Analysis for A. Salmonella Typhimurium (STm) and B. Salmonella Enteritidis (SEn) IgG antibodies to O-Ag by age at three sites, Malawi (Blue), Kenya (Purple), Burkina Faso (Orange)"
#| label: fig-combined

fitList_combined <- import_list(here("data", "7_data", "VacciNTS_sites", "fitListCombined.RData")) 

## Plot all on same graph
co <- c("Malawi", "BF", "Kenya")
st <- c("STm", "SEn")

for(s in st){
  fitList_combined[[s]]$Malawi$col$colModel <- "#0099CC"
  fitList_combined[[s]]$Malawi$col$colModelCI <- "#0099CC"
  fitList_combined[[s]]$Kenya$col$colModel <- "#FF9900"
  fitList_combined[[s]]$Kenya$col$colModelCI <- "#FF9900"
  fitList_combined[[s]]$BF$col$colModel <- "#9933FF"
  fitList_combined[[s]]$BF$col$colModelCI <- "#9933FF"
}
for(s in st){
  for(c in co){
fitList_combined[[s]][[c]]$dffit <- data.frame(xx=fitList_combined[[s]][[c]]$xx, yy=fitList_combined[[s]][[c]]$yy)
fitList_combined[[s]][[c]]$dfCI <- data.frame(xxCI=fitList_combined[[s]][[c]]$xxCI, yyLow=fitList_combined[[s]][[c]]$yyLow, yyHigh=fitList_combined[[s]][[c]]$yyHigh)
  }
}

# fitBF <- import_list(here("data", "7_data", "VacciNTS_sites", "fitBF.RData"))
# fitKenya <- import_list(here("data", "7_data", "VacciNTS_sites", "fitKenya.RData"))
# fitMalawi <- import_list(here("data", "7_data", "VacciNTS_sites", "fitMalawi.RData"))
# 
# extractList <- list()
# extractList[1] <- list(fitMalawi)
# extractList[2] <- list(fitBF)
# extractList[3] <- list(fitKenya)
# names(extractList) <- c("Malawi", "BF", "Kenya")
# extractList$Malawi$dfFit$colModel <- "#0099CC"
# extractList$Malawi$dfCI$colModelCI <- "#0099CC"
# extractList$Kenya$dfFit$colModel <- "#9933FF"
# extractList$Kenya$dfCI$colModelCI <- "#9933FF"
# extractList$BF$dfFit$colModel <- "#FF9900"
# extractList$BF$dfCI$colModelCI <- "#FF9900"
# ####
# # combined
#cols<-c(modcicol1="steelblue", modcicol2="purple")
#labels <- c(modcicol1="Malawi", modcicol2="BF")
cols<-c(modcicol1="steelblue", modcicol2="orange", modcicol3="purple")
labels <- c(modcicol1="Malawi", modcicol2="BF", modcicol3="Kenya")

gplotFunx2 <- function(fit1, fit2, fit3, cexText = 10, cexGeoM=2, strain, modcicol1, modcicol2, modcicol3){ #modcol1, modcicol1, modcol2, modcicol2, modcol3, modcicol3
  gc <- ggplot() +
    geom_line(data=fit1$dffit,aes(x=xx,y=yy,colour="Malawi"),lwd=0.6) +
    geom_point(data=fit1$datGeoM,aes(x=ageCatNum,y=geoM_better),pch=20,size=cexGeoM,col=modcicol1) +
    geom_ribbon(data=fit1$dfCI,aes(x=xxCI,ymin=yyLow,ymax=yyHigh, colour=modcicol1),alpha=0.4, lwd=0.1, fill=modcicol1) +
    geom_line(data=fit2$dffit,aes(x=xx,y=yy,colour="BF"),lwd=0.6) +
    geom_point(data=fit2$datGeoM,aes(x=ageCatNum,y=geoM_better),pch=20,size=cexGeoM,col=modcicol2) +
    geom_ribbon(data=fit2$dfCI,aes(x=xxCI,ymin=yyLow,ymax=yyHigh, colour=modcicol2), alpha=0.4,lwd=0.1, fill=modcicol2) +
    geom_line(data=fit3$dffit,aes(x=xx,y=yy,colour="Kenya"),lwd=0.6) +
    geom_point(data=fit3$datGeoM,aes(x=ageCatNum,y=geoM_better),pch=20,size=cexGeoM,col=modcicol3) +
    geom_ribbon(data=fit3$dfCI,aes(x=xxCI,ymin=yyLow,ymax=yyHigh, colour=modcicol3),alpha=0.4, lwd=0.1, fill=modcicol3) +
    theme_light() +
    scale_x_continuous(breaks = seq(0, 60, by = 3)) +
    scale_y_log10() +
    coord_cartesian(xlim = c(0,60)) +
    # coord_cartesian(xlim = c(0,60), ylim = c(min(fit3$dfCI$yyLow, na.rm=T), max(fit3$dfCI$yyHigh, na.rm=T))) +
    labs(y=paste(sep="",strain," IgG concentration (EU/ml)"),x="Age (months)", legend="cols")+
    # scale_colour_manual(name="Country",values=cols, labels=labels)+
    # theme(legend.position = "none") +
    geom_hline(yintercept=3, linetype="dashed", color = "red", size=0.4)+
    scale_color_manual(name="Country",
                     breaks=c("Malawi", "BF", "Kenya"),
                     values=c("Malawi"='steelblue', "BF"='orange', "Kenya"='purple'))+
    theme(axis.title = element_text(size=6),
          axis.text = element_text(size=6),
          legend.text = element_text(size=6),
          legend.title = element_text(size=6))
  return(gc)
}
plotlsC <- list()

for(s in st){
  plotlsC[[s]] <- gplotFunx2(fit1=fitList_combined[[s]]$Malawi, fit2=fitList_combined[[s]]$BF, fit3=fitList_combined[[s]]$Kenya, strain=s, modcicol1 = cols[1], modcicol2 = cols[2], modcicol3 = cols[3])
}

panel3 <- do.call("plot_grid", c(plotlsC, ncol=2, labels="AUTO", label_size=8))
print(panel3)
# fitList_combined[[s]]$BF$col$colModelCI, modcicol3 = fitList_combined[[s]]$Kenya$col$colModelCI)
# combplot2 <- (gplotFunx2(fit1=extractList[[1]], fit2=extractList[[2]], fit3=extractList[[3]], modcicol1 = fitList_combined$Malawi$col$colModelCI, modcicol2 = fitList_combined$BF$col$colModelCI, modcicol3 = fitList_combined$Kenya$col$colModelCI))
# combplot2
# ggsave(here("outputs","VacciNTS_sites", "IgG", "Combined_sites_BF_Malawi.tiff"), width = 9, height = 6)
# cowplot::plot_grid(combplot1, combplot2, nrow = 2)
```

```{r echo=FALSE, warning=FALSE, message=FALSE, results=FALSE}
parsMatTmp_mal <- import(here("data", "7_data", "Malaria", "parsMatTmp_malaria.csv")) %>% 
  rownames_to_column() %>% 
  rename(group = V1) %>% 
  mutate(IgGTime0CI_lo = as.numeric(substr(IgGTime0,8,12)),
         IgGTime0CI_hi = as.numeric(substr(IgGTime0,14,18)),
         IgGNadirCI = inside_parens(IgGNadir, sep="parens")) %>% 
  separate(IgGNadirCI,c('IgGNadirCI_lo', 'IgGNadirCI_hi'), ",") %>% 
  mutate(
    #IgGNadir = as.numeric(IgGNadir),
         IgGNadirCI_lo = as.numeric(IgGNadirCI_lo),
         IgGNadirCI_hi = as.numeric(IgGNadirCI_hi))
  # mutate(IgGTime0CI = str_extract(IgGTime0, "\\(([^()]+)\\)"))
fitList_malaria <- import_list(here("data", "7_data", "Malaria", "fitList_malaria.RData"))
peaksLowsTroughsMat_Mal <- import(here("data", "7_data", "Malaria", "peaksLowsTroughsMat_Malaria.csv")) %>% 
  rename(peak2 = peak) %>% 
  mutate(peak = ifelse(is.na(peak2),peak2,trough),
         peak = as.numeric(peak),
         low = as.numeric(low))
co <- c(paste0("STmL", 1:20), paste0("STmH", 1:20))
# parsMatTmp_malaria <- list()
CpIgG <- list()
parsMatTmp <- list()
for(c in co){
  CpIgG$STm[[c]] <- filter(peaksLowsTroughsMat_Mal, Group==c)
  parsMatTmp$STm[[c]] <- filter(parsMatTmp_mal, group==c)
  # CpIgG$STm[[c]]$low_age <- round(CpIgG$STm[[c]]$low_age,digits=1)
  # CpIgG$STm[[c]]$peak_age <- round(CpIgG$STm[[c]]$peak_age, digits = 1)
}

# CpIgG_df <- do.call("rbind", CpIgG)
# parsMat_df <- do.call("rbind", parsMat)
# maltab <- left_join(peaksLowsTroughsMat_Mal, parsMatTmp_mal, by=c("group")) %>% 
#   mutate(Group =  substr(group,4,4),
#          Group = ifelse(Group=="L", "Low", "High"),
#          Trans = as.numeric(str_extract(group,"[0-9]{1,2}")))
maltab <- peaksLowsTroughsMat_Mal %>% 
  rename(st = Group,
         Trans = malaria_prev,
         Group = malaria_HL) %>% 
  mutate(AUC_comb = paste0(sep="", round(AUC,digits=1)," (",round(AUClo,digits=1)," - ",round(AUChi,digits=2), ")"),
         IgGage0_comb = paste0(sep="", round(IgG_age0,digits=1)," (",round(IgGTime0CI_lo,digits=1)," - ",round(IgGTime0CI_hi,digits=1), ")"),
         lowage_comb = paste0(sep="", round(low_age,digits=1)," (",round(nadir_xxlow,digits=1)," - ",round(nadir_xxhigh,digits=1), ")"),
         IgGnadir_comb = paste0(sep="", round(low,digits=1)," (",round(IgGNadirCI_lo,digits=1)," - ",round(IgGNadirCI_hi,digits=1), ")"))
# Cptbl <- maltab %>% 
#   select(c(Group, Trans, IgGTime0, low_age, IgGNadir, peak_age, IgGPeak, IgGTime60)) %>% 
#   arrange(Trans)

age0IgGH5 <- maltab %>% 
  subset(Group=="High" & Trans==5, IgGage0_comb)
age0IgGL5 <- maltab %>% 
  subset(Group=="Low" & Trans==5, IgGage0_comb)
age0IgGH10 <- maltab %>% 
  subset(Group=="High" & Trans==10, IgGage0_comb)
age0IgGL10 <- maltab %>% 
  subset(Group=="Low" & Trans==10, IgGage0_comb)
age0IgGH20 <- maltab %>% 
  subset(Group=="High" & Trans==20, IgGage0_comb)
age0IgGL20 <- maltab %>% 
  subset(Group=="Low" & Trans==20, IgGage0_comb)
AUCH5 <- maltab %>% 
  subset(Group=="High" & Trans==5, AUC_comb)
AUCL5<- maltab %>% 
  subset(Group=="Low" & Trans==5, AUC_comb)
AUCH10 <- maltab %>% 
  subset(Group=="High" & Trans==10, AUC_comb)
AUCL10<- maltab %>% 
  subset(Group=="Low" & Trans==10, AUC_comb)
AUCH20 <- maltab %>% 
  subset(Group=="High" & Trans==20, AUC_comb)
AUCL20<- maltab %>% 
  subset(Group=="Low" & Trans==20, IgGnadir_comb)
nadirH5 <- maltab %>% 
  subset(Group=="High" & Trans==5, IgGnadir_comb)
nadirL5<- maltab %>% 
  subset(Group=="Low" & Trans==5, IgGnadir_comb)
nadirH10 <- maltab %>% 
  subset(Group=="High" & Trans==10, IgGnadir_comb)
nadirL10<- maltab %>% 
  subset(Group=="Low" & Trans==10, IgGnadir_comb)
nadirH20 <- maltab %>% 
  subset(Group=="High" & Trans==20, IgGnadir_comb)
nadirL20<- maltab %>% 
  subset(Group=="Low" & Trans==20, IgGnadir_comb)
lowageH5 <- maltab %>% 
  subset(Group=="High" & Trans==5, lowage_comb)
lowageL5<- maltab %>% 
  subset(Group=="Low" & Trans==5, lowage_comb)
lowageH10 <- maltab %>% 
  subset(Group=="High" & Trans==10, lowage_comb)
lowageL10<- maltab %>% 
  subset(Group=="Low" & Trans==10, lowage_comb)
lowageH20 <- maltab %>% 
  subset(Group=="High" & Trans==20, lowage_comb)
lowageL20<- maltab %>% 
  subset(Group=="Low" & Trans==20, lowage_comb)
```

```{r echo=FALSE, warning=FALSE, fig.align = "centre", fig.width = 8, fig.height=4, out.width = "8.5in"}
#| fig-cap: "Change Point Analysis for Salmonella Typhimurium (STm) IgG antibodies to O-Ag by age malaria transmission area. A. >=5% transmission, B. <5% transmission"
#| label: fig-malHL
#| 
H <- ggPlotFun(fit=fitList_malaria[["STmH5"]],fit2=fitList_malaria[["STmH5"]], strain="‚â•5%",varNameOrigNum=paste(sep="","STmH5","_num"),colModel="darkgreen",colModelCI="darkgreen",colChangepoints="orchid",c="STmH5",s="STm")$g
L <- ggPlotFun(fit=fitList_malaria[["STmL5"]],fit2=fitList_malaria[["STmL5"]], strain="<5%",varNameOrigNum=paste(sep="","STmL5","_num"),colModel="darkgreen",colModelCI="darkgreen",colChangepoints="orchid", c="STmL5",s="STm")$g
cowplot::plot_grid(H,L, nrow=1,labels="AUTO", label_size=8)
```

```{r echo=FALSE, warning=FALSE, fig.align = "centre", fig.width = 8, fig.height=5.5, out.width = "8.5in"}
#| fig-cap: "Change Point Analysis model outputs; estimated population levels of Salmonella Typhimurium (STm) IgG antibodies to O-Ag at different age malaria transmission cut-offs. High group is malaria tranmsission percentage value on x-axis and above; low group is below malaria transmission percentage value on x-axis A. At age 0, B. At IgG Nadir C. Age at IgG nadir D. Area under the curve between age 0 and IgG nadir"
#| label: fig-malsum
#| 

#####
## Plot graphs
plot_age0 <- maltab %>% 
  ggplot(aes(x=Trans, y=IgG_age0, colour=Group,fill=Group, ymin=IgGTime0CI_lo, ymax= IgGTime0CI_hi))+
  geom_point()+
  geom_line() +
  geom_ribbon(alpha=0.5, linetype=0)+
  ggtitle("IgG to STm at age 0")+
  xlab("MRDT positive %")+
  ylab("IgG concentration (EU/ml)")+
  # scale_fill_discrete(name="Malaria Transmission")+
  #labs(fill='Malaria Transmission') +
  # guides(fill=guide_legend(title="Malaria Transmission"))+
  #labs(color='Malaria Transmission') +
  #scale_colour_manual(values=c("#F8766D","#00BFC4"), title="Malaria Transmission")+
  # scale_linetype_manual(values=c(4, 5)) +
  theme_minimal()+
  theme(title = element_text(size=8, face = "bold"),
        axis.title = element_text(size = 8, face = "plain"),
        axis.text = element_text(size = 7, face = "plain"),
        legend.title = element_text(size = 8, face="plain"),
        legend.text = element_text(size=8))

plot_low <- maltab %>% 
  ggplot(aes(x=Trans,y=low, ymin=IgGNadirCI_lo, ymax=IgGNadirCI_hi, fill=Group, colour=Group))+
  geom_point()+
  geom_line()+
  geom_ribbon(alpha=0.5, linetype=0)+
  ggtitle("IgG to STm at nadir")+
  xlab("Malaria prevalence (%)")+
  ylab("IgG concentration (EU/ml)")+
  # labs(color='Malaria Transmission') +
  # scale_fill_manual(values=c("#F8766D","#00BFC4"))+
  # scale_linetype_manual(values=c(4, 5)) +
  theme_minimal()+
  # guides(fill = guide_legend(override.aes = list(linetype = 0),
  #                            title = "Malaria Transmission (%)")) +
  theme(title = element_text(size=8, face = "bold"),
        axis.title = element_text(size = 8, face = "plain"),
        axis.text = element_text(size = 7, face = "plain"),
        legend.title = element_text(size = 8, face="plain"),
        legend.text = element_text(size=8))


plot_lowage <- maltab %>% 
  ggplot(aes(x=Trans, y=low_age, colour=Group, ymin=nadir_xxlow, ymax=nadir_xxhigh, fill=Group))+
  geom_point()+
  geom_line()+
  geom_ribbon(alpha=0.5, linetype=0)+
  ggtitle("Age at nadir of IgG to STm")+
  xlab("Malaria prevalence (%)")+
  ylab("Age (months)")+
  # labs(fill='Malaria Transmission') +
  theme_minimal()+
  theme(title = element_text(size=8, face = "bold"),
        axis.title = element_text(size = 8, face = "plain"),
        axis.text = element_text(size = 7, face = "plain"),
        legend.title = element_text(size = 8, face="plain"),
        legend.text = element_text(size=8))


plot_AUC <- maltab %>% 
  ggplot(aes(x=Trans,y=AUC, ymin=AUClo, ymax=AUChi, fill=Group, colour=Group))+
  geom_point()+
  geom_line()+
  geom_ribbon(alpha=0.5, linetype=0)+
  ggtitle("Area under the curve (AUC)")+
  xlab("Malaria prevalence (%)")+
  ylab("Area under the curve")+
  #labs(color='Malaria Transmission') +
  theme_minimal()+
  theme(title = element_text(size=8, face = "bold"),
        axis.title = element_text(size = 8, face = "plain"),
        axis.text = element_text(size = 7, face = "plain"),
        legend.title = element_text(size = 8, face="plain"),
        legend.text = element_text(size=8))


cowplot::plot_grid(plot_age0,plot_low,plot_lowage,plot_AUC, labels = "AUTO", label_size=8)
```

\newpage

<!-- % changing the orientation to portrait again -------------------------- -->

```{=tex}
\KOMAoptions{usegeometry, paper=portrait,pagesize}
\recalctypearea
```
### Subgroup analysis by malaria transmission areas (Malawi Site)

In Malawi, the analysis was stratified by malaria transmission intensity for *S.* Typhimurium; the most common serovar causing invasive NTS disease in Malawi. In the high malaria transmission areas the modeled IgG at age 0 was `{r} age0IgGH5` EU/ml compared to `{r} age0IgGL5` for low malaria transmission EAs when using the cut-off was 5% or above (@fig-malHL, @fig-malsum A, @tbl-mal). The IgG at age 0 was `{r} age0IgGH10` EU/ml and `{r} age0IgGH20` for 10 & 20% malaria transmission and above respectively, compared to `{r} age0IgGL10` and `{r} age0IgGL20` for below 10 & 20% malaria transmission. The area under the curve (AUC) between age 0 to the age at antibody nadir was `{r} AUCH5` for $\ge$ 5%, `{r} AUCH10` & `{r} AUCH20` for $\ge$ 10% & $\ge$ 20% malaria transmission areas compared to `{r} AUCL5`, `{r} AUCL10` & `{r} AUCL20` for \< 5%, \< 10% & \< 20% malaria transmission respectively (@fig-malsum D). The lowest antibody level at the nadir was `{r} nadirH5` EU/ml for $\ge$ 5%, `{r} nadirH10` & `{r} nadirH20` for $\ge$ 10% & $\ge$ 20% malaria transmission compared to `{r} nadirL5` EU/ml for \< 5%, `{r} nadirL10` & `{r} nadirL20` for \< 10% & \< 20% (@fig-malsum B). IgG at nadir was `{r} lowageH5` months for malaria transmission 5% and above, `{r} lowageH10` months ($\ge$ 10%) & `{r} lowageH20` months ($\ge$ 20%) malaria transmission areas compared to children in lower malaria transmission areas `{r} lowageL5` months (\<5%), `{r} lowageL10` months (\<10%) & `{r} lowageL20` months (\<20%) (@fig-malsum C).

## Discussion

The rapid early waning of maternal anti-NTS antibody in infants across all African sites indicates early vaccine administration dosing would be desirable. Variation in nadirs, peaks and plateaus of anti-NTS antibody may suggest a variable force of infection and epidemiology of host susceptibility by site. Despite differences in the force of infection and absolute antibody titres between sites, the similarities in ages of peaks and nadirs in immunity across both *S*. Typhimurium and *S*. Enteritidis highlights the window of susceptibility that would benefit from vaccine-derived protection. The difference in absolute values for the ELISA assays may indicate either a difference in force of infection of enteric NTS events inducing serovar specific-immunity which may be induced by cross-protection by a range of non-pathogenic NTS serovars, as highlighted in chapter 5 and 6. The differences between sites may also reflect differing immune responses in children at different Sub-Saharan African sites, including the varying epidemiology of immune-suppressing co-morbidities such as malaria, anaemia, malnutrition, sickle cell disease and HIV.

As illustrated in chapter 4, the crude estimates of invasive NTS disease, via blood culture confirmation suggests that Malawi may have the highest incidence of iNTS, and has the lowest median S.Typhimurium and S.Enteritidis IgG. This may reflect a higher immuno-susceptibility in Malawi, which would be concordant with the lower overall antibody levels, lower antibody concentrations at the nadir between 4-5 months and potentially longer time children spend below a threshold of protection [@fig-inverseiNTSAb] (as yet not established cut-off, 25 EU/ml suggested by preliminary analysis using reverse cumulative distribution curves @fig-RCDagebin), compared to children in other settings such as Burkina Faso which had higher anti-NTS IgG concentrations, *S*. Typhimurium more so than *S*. Enteritidis. However, in Kenya, where a high proportion of iNTS is due to *S*. Enteriditis [@kariuki_high_2020], the anti- *S*. Typhimurium IgG antibody concentration was higher than seen in Malawi and Kenya, which suggests that the force of infection from enteric exposure events to S. Enteriditis may be higher in the Kenyan population, however, this may not translate into better protection against invasive disease. Salmonella Enteritidis is relatively more resistant to serum killing than S. Typhimurium [@onsare_relationship_2015], and therefore antibody-mediated immunity may be less important in protection against iNTS, compared to cell-mediated immunity. Children across all sites rapidly acquire antibodies to S. Typhimurium and S. Enteriditis LPS, and reach a plateau at a similar age for S. Typhimurium at around 27 months, and between 21 and 27 months for S. Enteritidis. Interestingly there is wider divergence in relative antibody concentrations between the sites after 2 years of age for S. Enteritidis; Malawi the levels remain static from ages 24 months and above, compared to Burkina Faso and Kenya which continue to increase substantially. This may indicate higher force of infection in Burkina Faso and Kenya for S. Enteriditis. It would be important to have concurrent stool exposure data to support this hypothesis (see discussion in chapter 6).

These findings suggest children living in higher malaria transmission areas have lower maternal antibody at birth. However, there are wide confidence intervals due to fewer number of children recruited from higher malaria transmission areas, although confidence intervals do not overlap at 10% and 20%. This is an important finding that requires further investigation. Possible explanations include confounding, which may result from higher exposure to *Salmonella* by the mothers in the low malarial areas, resulting in higher maternal antibody concentrations that are transferred to the fetus. However, as we did not collect stool samples from the mothers, this is not possible to estimate directly. The descriptive analysis in chapter 5 illustrated an association of higher *Salmonella* stool positivity by PCR in children from areas with higher malaria transmission. However, if this force of infection in children is also seen in their mothers living in the high malarial areas, then this would be expected to have an opposite effect, with higher maternal anti-NTS antibodies in the higher malarial areas. Repeated episodes of maternal malaria may lead to reduced acquisition of NTS-immunity, as seen in children [@cunnington_suppression_2010], although this seems less likely in adults as robust immunity is assumed. It may be more likely to reflect immunosencence in mothers due to lower exposure to *Salmonella* leading to boosting of immunity. There could be an effect of seasonality affecting when mothers in the higher malaria areas were most recently exposed to *Salmonella*, for example if maternal samples were collected just prior to the start of rainy season, the mothers may not have been exposed since the last rainy season up to 9 months prior, if this occurred in the higher malaria areas more frequently than the lower malaria areas this could introduce confounding. The study design was aimed to recruit at each EA every three months to avoid this seasonal bias, however, there were interruptions due cyclone Freddy [@freddy:2023] and seasonal flooding which introduced some delays to the sampling schedule. Further analysis including multi-level modeling could be used to explore this relationship further. The finding of lower maternal anti-NTS antibody in children living in higher malarial areas may be a true finding, either secondary to maternal placental malaria, although this effect primarily affects primigravida women, and result in reduced trans-placental transfer of maternal antibodies [@cumberland_maternal_2007]. As discussed in chapter 1, transplacental transfer of antibodies can be impaired by a number of factors, including HIV, malaria and hypergammaglobulinaemia; and it is not clear if hypergammaglobulinaemia is a mediator on the pathway between maternal co-morbid inflammatory conditions and reduced antibody transfer [@atwell_biological_2022]. This will require further investigation of mother-infant dyads, ideally with maternal serum samples collected at the time of delivery, cord blood samples, infant blood samples and known malaria and HIV status of the mother. Details about the gestation of the infant at birth will be important information, as prematurity is associated with reduced transplacental antibody transfer, with fetal concentrations of antibody reaching 50% of maternal at 30 weeks gestation and increasing until term [@atwell_biological_2022]. The majority of IgG is transported in the last 4 weeks of full-term pregnancy [@calvert2017]. Malaria in pregnancy (MIP) is associated with prematurity and interuterine growth restriction (IUGR) leading to reduced blood flow to the fetus and prematurity [@bauserman2019]. MIP is attributable to up to 36% of prematurity in malaria-endemic regions [@bauserman2019], which could be a potential mechanism for the lower anti-NTS antibodies seen in the first few months of life in higher malarial areas.

### Limitations

This change point analysis of cross-sectional seroepidemiological samples at a population level allows us to identify trends across age-groups across a range of geographical settings. There are limitations in interpreting cross-sectional data, including time and geographical location variability which are not captured. Differences in sample collection periods and seasons across different countries, there will be variation in host susceptibility e.g. malaria which may delay the acquisition of immunity to salmonella for children living in high malaria transmission areas subject to repeated malaria infections. In addition, as demonstrated in chapter 5, the exposure of NTS is seasonal, which will have an impact on the rate that children acquire antibody. As a result this could lead to variation in antibody concentrations and therefore absolute IgG concentrations should be interpreted with caution, as samples were collected across the sub-Saharan African sites over different time periods and likely have different seasonal patterns of salmonella exposures and host susceptibility. In addition the age profiles may change with time, due to changes in epidemiology of Salmonella exposure which has not been explicitly modeled, and cannot be captured without multiple serological measurements over time. However, the sampling framework in Malawi recruited children over multiple seasons and geographic areas, with paired sampling 3 months apart, and a small subset with 3 monthly sampling over 12 months. Analysis of this longitudinal data can offer further insights into the dynamics of the acquisition of natural immunity over seasons in Malawi. Data was not available on the epidemiology of host susceptibility factors in the children recruited in Burkina Faso and Kenya, or data on *Salmonella* enteric exposures which limits further interpretation of the differences in antibody concentrations between sites.

The O-Antigen used in this ELISA may have some cross-reactivity with the polysacharide core antigen of other serovars and may not be specific to the typhimurium and enteritidis serogroups (04 and O9 respectively). However, assessment of specificity was assessed by Aruta *et al.* [@aruta_characterization_2023], as part of the assay development, and specificity was high, although heterologous O-Antigen competition was only compared to Shigella flexneri 3a. When compared in our samples there was a strong association of a detected salmonella O4 stool exposure and *S*. Typhimurium IgG antibody responses (chapter 6), compared to children with no measured stool exposure which further supports the immunodominance of O4/ O9 antigens. Previous research has shown a higher degree of protection from antibodies directed at immuno-dominant serovar specific O-antigens relative to antibodies directed at O-antigens common across serogroups (e.g. O:12) [@hormaeche1996, @segall1993, @svenson1981], with up to \>2500 fold higher protective activity reported between O4 and O12 antibodies [@carlin1987]. Maternally derived anti-NTS antibody has been shown to be bactericidal in infants in Vietnam. However, it would be important to explore the functional activity of maternally acquired immunity with serum bactericidal assays, and explore any differences in higher malaria exposed populations.

Malaria transmission intensity was determined by cross-sectional MRDT testing in children at the time of blood sampling, and may not capture the true exposure of individuals during the preceding months that may impact on the anti-NTS IgG concentration. There were only small numbers of children sampled in the first few months of life, particularly in the higher malarial areas, therefore further studies should focus on increasing numbers recruited in the first few months of life, and ideally mothers and infants recruited at birth with cord blood samples will provide much richer data.

## **Conclusions**

The difference in immunity in infants in malaria endemic region of Malawi requires further investigation to establish if this is a true finding. If true, however this finding would be important to inform public health interventions in reducing the burden of iNTS in infants, including reinforcing maternal chemoprophylaxis for malaria in high-risk areas to improve maternal antibody transfer. This could be beneficial to many other early-life vaccine-preventable diseases that depend on protection from maternal antibodies. The differences in antibody concentrations between geographic settings requires further correlation with data on enteric Salmonella exposures, host susceptibility factors, particularly malaria, and invasive NTS disease at each site. Modelling antibody responses with invasive disease by age, along with triangulation with immunological markers from vaccine trial immunogenicity data and controlled human infection studies will be important to inform serological correlates of protection and accelerate vaccine licensure.
